_本文主要从自动化测试的角度来看jenkins_

# [jenkins](https://jenkins.io)
>In a nutshell, Jenkins is the leading open-source automation server. Built with Java, it provides over 1000 plugins to support automating virtually anything, so that humans can actually spend their time doing things machines cannot.


特点：

* 持续集成与持续部署 即CI/CD
* 容易安装
* 容易配置
* 插件丰富
* 扩展性强
* 分布式构建

## 用途

>Use Jenkins to automate your development workflow so you can focus on work that matters most. Jenkins is commonly used for:

>* Building projects
>* Running tests to detect bugs and other issues as soon as they are introduced
>* Static code analysis
>* Deployment

>Execute repetitive tasks, save time, and optimize your development process with Jenkins.



## Continuous Integration(CI)：持续集成

### 重温经典

大师martin fowler[这样说](http://www.martinfowler.com/articles/continuousIntegration.html)：
>Continuous Integration is a software development practice where members of a team integrate their work frequently, usually each person integrates at least daily - leading to multiple integrations per day. Each integration is verified by an automated build (including test) to detect integration errors as quickly as possible. Many teams find that this approach leads to significantly reduced integration problems and allows a team to develop cohesive software more rapidly. 


好处：

* At all times you know where you are, what works, what doesn't, the outstanding bugs you have in your system.
* have dramatically less bugs, both in production and in process


要素：

* Maintain a Single Source Repository.
* Automate the Build
* Make Your Build Self-Testing
* Everyone Commits To the Mainline Every Day
* Every Commit Should Build the Mainline on an Integration Machine
* Fix Broken Builds Immediately
* Keep the Build Fast
* Test in a Clone of the Production Environment
* Make it Easy for Anyone to Get the Latest Executable
* Everyone can see what's happening
* Automate Deployment

### [流程](http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html)

持续集成的目的，就是让产品可以快速迭代，同时还能保持高质量。它的核心措施是，代码集成到主干之前，必须通过自动化测试。只要有一个测试用例失败，就不能集成。

根据持续集成的设计，代码从提交到生产，整个过程有以下几步。

* 提交

流程的第一步，是开发者向代码仓库提交代码。所有后面的步骤都始于本地代码的一次提交（commit）。

* 测试(第一轮)

代码仓库对commit操作配置了钩子（hook），只要提交代码或者合并进主干，就会跑自动化测试。

测试有好几种。

>单元测试：针对函数或模块的测试
集成测试：针对整体产品的某个功能的测试，又称功能测试
端对端测试：从用户界面直达数据库的全链路测试

第一轮至少要跑单元测试。

* 构建

 通过第一轮测试，代码就可以合并进主干，就算可以交付了。

交付后，就先进行构建（build），再进入第二轮测试。所谓构建，指的是将源码转换为可以运行的实际代码，比如安装依赖，配置各种资源（样式表、JS脚本、图片）等等。

* 测试（第二轮）

构建完成，就要进行第二轮测试。如果第一轮已经涵盖了所有测试内容，第二轮可以省略，当然，这时构建步骤也要移到第一轮测试前面。

第二轮是全面测试，单元测试和集成测试都会跑，有条件的话，也要做端对端测试。所有测试以自动化为主，少数无法自动化的测试用例，就要人工跑。

新版本的每一个更新点都必须测试到。如果测试的覆盖率不高，进入后面的部署阶段后，很可能会出现严重的问题。


![realworld-pipeline-flow](./img/realworld-pipeline-flow.png)

## 自动化测试

自动化测试在参与到项目中时，会遇到如下的问题：

* 脚本运行环境的构建
* 测试代码的更新与发布
* 脚本运行结果与反馈


### 运行环境构建

运行环境包括：测试框架，测试脚本，测试工具，配置文件，环境变量，网络配置等，这些环境要素的安装和配置可能非常繁琐，以至于我们需要编写手册来指导使用者，甚至要不耐其烦的上门服务。

由于使用者的系统是多样的，运行环境无法适配其稍许的不同，我们也没有精力去做兼容性测试。

实际上，将自动化测试部署到个人的办公环境去执行，就意味着风险，而这些问题也往往是很难定位，自动化测试的体验也是非常不好的。

jenkins的解决方法：

通过分布式构建，将运行环境构建在server端的agent上，达到运行环境的一致性。

### 软件的更新与发布

测试脚本等代码使用svn，git等工具来管理，但当脚本更新时，我们是如何将其发布到测试环境中的呢？

* copy给脚本执行者
* 赋予脚本执行人权限来下载代码

显而易见，这两种方式都不能及时将最新的代码部署到测试环境中，另外也容易让执行者混淆，比如我们可能会打分支或tag，这对于测试执行者来说显然是难以区分与使用的。

jenkins的解决方法：

通过scm的插件，预先配置分支路径和权限，在执行脚本前，下载最新（或指定revision）的测试代码。

### 测试结果与反馈

自动化测试好的体验在于：快速，准确的测试；要想达到这个目标，需要持续不断的修正，获取到原始的执行数据是基础。

通常，这些原始数据都保存在执行者环境中，这样会造成一些问题：

* 数据不完整：执行者一般会提供最好的执行数据，而非完全的执行数据，从而遗漏掉一些问题
* 数据不及时：无法第一时间掌握这些数据，也就不能第一时间分析与修改，会造成这些错误重复的出现。

jenkins的解决方法：

对于有效测试，可以在测试结束后，自动汇总测试结果，发送邮件，并将结果保存在server端。




